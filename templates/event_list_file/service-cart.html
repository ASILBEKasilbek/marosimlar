{% load humanize %}

<!-- SORT DROPDOWN -->
<div class="d-flex justify-content-end mb-3">
    <div class="dropdown">
        <button class="btn btn-outline-primary dropdown-toggle shadow-sm" type="button" data-bs-toggle="dropdown">
            Tartiblash
        </button>
        <ul class="dropdown-menu shadow">
            <li><a class="dropdown-item" href="?sort=popular{% if request.GET.event_type %}&event_type={{ request.GET.event_type }}{% endif %}">üî• Ommabop</a></li>
            <li><a class="dropdown-item" href="?sort=cheap{% if request.GET.event_type %}&event_type={{ request.GET.event_type }}{% endif %}">üí∏ Arzon</a></li>
            <li><a class="dropdown-item" href="?sort=expensive{% if request.GET.event_type %}&event_type={{ request.GET.event_type }}{% endif %}">üíé Qimmat</a></li>
            <li><a class="dropdown-item" href="?sort=top-rated{% if request.GET.event_type %}&event_type={{ request.GET.event_type }}{% endif %}">‚≠ê Yuqori baholangan</a></li>
        </ul>
    </div>
</div>

<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-3" role="list">
  {% for service in services %}
  <div class="col" role="listitem">
    <div class="card h-100 border-0 shadow-sm hover-card d-flex flex-column position-relative overflow-hidden" aria-labelledby="service-{{ service.slug }}-title">

      <!-- Image or placeholder -->
      <div class="position-relative" style="height: 180px; background: #f8f9fa;">
          {% if service.image1 %}
          <img src="{{ service.image1.url }}" 
              class="card-img-top w-100 h-100" 
              alt="{{ service.title }} rasm" 
              loading="lazy" 
              decoding="async" 
              style="object-fit: cover; transition: transform 0.3s ease;">
          {% endif %}

          {% if service.is_verified %}
          <div class="verified-star" title="Verified on MyPlatform">
            ‚òÖ
          </div>
          {% endif %}

          <!-- Price badge -->
          <span class="badge position-absolute top-2 start-2 px-3 py-1 rounded-pill shadow-sm d-flex align-items-center justify-content-center"
                style="
                  font-weight: 600; 
                  font-size: 0.85rem; 
                  backdrop-filter: blur(8px); 
                  background-color: rgba(0,123,255,0.85); 
                  color: white; 
                  z-index: 10; 
                  border: 1px solid rgba(255,255,255,0.5);
                  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;"
                aria-label="Narx: {% if service.price %}{{ service.price|intcomma }} so'm{% else %}Kelishilgan{% endif %}">
              {% if service.price %}
                {{ service.price|floatformat:0|intcomma }} so'm
              {% else %}
                Kelishilgan
              {% endif %}
          </span>
      </div>


      <!-- Card body -->
      <div class="card-body d-flex flex-column p-3">
        <h6 id="service-{{ service.slug }}-title" class="card-title fw-bold mb-2 text-truncate" style="font-size: 1.1rem;">
          {{ service.title }}
        </h6>

        {% if service.description %}
        <p class="text-muted small mb-3 text-truncate-2" style="font-size: 0.9rem;">
          {{ service.description|truncatewords:15 }}
        </p>
        {% endif %}

        {% if service.created_at %}
        <p class="text-muted small mb-2 custom-date" aria-label="Yaratilgan sana: {{ service.created_at|date:'d M Y' }}">
          {{ service.created_at|date:"d M Y" }}
        </p>
        {% endif %}

        <a href="{% url 'service_detail' slug=service.slug %}" class="btn btn-outline-primary btn-sm w-100 mt-auto rounded-pill" role="button">
          Batafsil ‚Üí
        </a>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<style>
/* Verified star on top-right of image */
.card-body {
    margin-top: 8px; /* rasm va badge ostiga joy berish */
}

.verified-star {
  font-size: 22px;
  color: gold;
  position: absolute;
  top: 8px;
  right: 8px;
  cursor: default;
  transition: transform 0.2s, text-shadow 0.3s;
  z-index: 10;
}

.verified-star:hover {
  transform: rotate(20deg) scale(1.3);
  text-shadow: 
      0 0 8px gold,
      0 0 15px gold,
      0 0 20px orange,
      0 0 25px gold;
  color: #FFD700; /* yanada yorqin sariq */
}

/* CSS Variables for Theming */
:root {
  --primary: #007bff;
  --warning: #ffc107;
  --shadow: 0 4px 12px rgba(0,0,0,0.1);
}

/* Minimal hover for performance and accessibility */
.hover-card {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.hover-card:hover, .hover-card:focus {
  transform: translateY(-5px);
  box-shadow: var(--shadow);
}

/* Image hover effect */
.hover-card img {
  transition: transform 0.3s ease;
}
.hover-card:hover img {
  transform: scale(1.05);
}

/* Text truncation */
.text-truncate {
  display: -webkit-box;
  -webkit-line-clamp: 1;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.text-truncate-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Badge styling */
.badge {
  font-size: 0.85rem;
  padding: 0.3em 0.6em;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  transition: transform 0.2s ease;
}
.hover-card:hover .badge {
  transform: scale(1.05);
}

/* High contrast for accessibility */
.badge.bg-primary { background-color: var(--primary) !important; color: #fff; }
.badge.bg-warning { background-color: var(--warning) !important; color: #212529; }

/* Button hover */
.btn-outline-primary {
  transition: background-color 0.2s ease, color 0.2s ease;
}
.btn-outline-primary:hover {
  background-color: var(--primary);
  color: #fff;
}
.custom-date {
    font-size: 0.8rem;        /* kichikroq shrift */
    letter-spacing: 0.5px;    /* harflar orasini biroz uzaytiradi */
}
</style>

<!-- PAGINATION -->
{% if services.has_other_pages %}
<nav aria-label="Page navigation" class="mt-4">
    <ul class="pagination justify-content-center">
        {% if services.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?page={{ services.previous_page_number }}">Oldingi</a>
        </li>
        {% endif %}
        {% for num in services.paginator.page_range %}
        <li class="page-item {% if services.number == num %}active{% endif %}">
            <a class="page-link" href="?page={{ num }}">{{ num }}</a>
        </li>
        {% endfor %}
        {% if services.has_next %}
        <li class="page-item">
            <a class="page-link" href="?page={{ services.next_page_number }}">Keyingi</a>
        </li>
        {% endif %}
    </ul>
</nav>
{% endif %}
