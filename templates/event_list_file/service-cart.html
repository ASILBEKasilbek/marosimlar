
<!-- SORT DROPDOWN -->
<div class="d-flex justify-content-end mb-3">
    <div class="dropdown">
        <button class="btn btn-outline-primary dropdown-toggle shadow-sm" type="button" data-bs-toggle="dropdown">
            Tartiblash
        </button>
        <ul class="dropdown-menu shadow">
            <li><a class="dropdown-item" href="?sort=popular{% if request.GET.event_type %}&event_type={{ request.GET.event_type }}{% endif %}">üî• Ommabop</a></li>
            <li><a class="dropdown-item" href="?sort=cheap{% if request.GET.event_type %}&event_type={{ request.GET.event_type }}{% endif %}">üí∏ Arzon</a></li>
            <li><a class="dropdown-item" href="?sort=expensive{% if request.GET.event_type %}&event_type={{ request.GET.event_type }}{% endif %}">üíé Qimmat</a></li>
            <li><a class="dropdown-item" href="?sort=top-rated{% if request.GET.event_type %}&event_type={{ request.GET.event_type }}{% endif %}">‚≠ê Yuqori baholangan</a></li>
        </ul>
    </div>
</div>

<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-3" role="list">
  {% for service in services %}
  <div class="col" role="listitem">
    <div class="card h-100 border-0 shadow-sm hover-card d-flex flex-column position-relative overflow-hidden" aria-labelledby="service-{{ service.slug }}-title">

      <!-- Image or placeholder -->
      <div class="position-relative" style="height: 180px; background: #f8f9fa;">
        {% if service.image1 %}
        <img src="{{ service.image1.url }}" 
             class="card-img-top w-100 h-100" 
             alt="{{ service.title }} rasm" 
             loading="lazy" 
             decoding="async" 
             style="object-fit: cover; transition: transform 0.3s ease;">
        {% endif %}

        <!-- Verified badge (top-right, rasm ustida) -->
        {% if service.is_verified %}
        <div class="verified-star" title="Verified on MyPlatform">
          ‚òÖ
        </div>
        {% endif %}

        <!-- Price badge (top-left) -->
        {% if service.price %}
        <span class="badge bg-primary text-white position-absolute top-2 start-2 px-2 py-1 rounded-pill" aria-label="Narx: {{ service.price|floatformat:2 }} so'm">
          üí∞ {{ service.price|floatformat:2 }} so'm
        </span>
        {% else %}
        <span class="badge bg-warning text-dark position-absolute top-2 start-2 px-2 py-1 rounded-pill" aria-label="Narx: kelishilgan">
          Kelishilgan
        </span>
        {% endif %}
      </div>

      <!-- Card body -->
      <div class="card-body d-flex flex-column p-3">
        <!-- Title -->
        <h6 id="service-{{ service.slug }}-title" class="card-title fw-bold mb-2 text-truncate" style="font-size: 1.1rem;">{{ service.title }}</h6>

        <!-- Short description -->
        {% if service.description %}
        <p class="text-muted small mb-3 text-truncate-2" style="font-size: 0.9rem;">{{ service.description|truncatewords:15 }}</p>
        {% endif %}

        <!-- No-image fallback -->
        {% if not service.image1 %}
          {% if service.price %}
          <p class="text-primary fw-bold mb-1" aria-label="Narx: {{ service.price|floatformat:2 }} so'm">üí∞ {{ service.price|floatformat:2 }} so'm</p>
          {% else %}
          <p class="text-warning fw-bold mb-1" aria-label="Narx: kelishilgan">Narx: kelishilgan</p>
          {% endif %}
        {% endif %}

        <!-- Created At -->
        {% if service.created_at %}
        <p class="text-muted small mb-2" aria-label="Yaratilgan sana: {{ service.created_at|date:'d M Y' }}">üìÖ {{ service.created_at|date:"d M Y" }}</p>
        {% endif %}

        <!-- CTA button -->
        <a href="{% url 'service_detail' slug=service.slug %}" class="btn btn-outline-primary btn-sm w-100 mt-auto rounded-pill" role="button">
          Batafsil ‚Üí
        </a>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<style>
/* Verified star on top-right of image */
.verified-star {
  font-size: 20px;
  color: gold;
  text-shadow: 0 0 2px rgba(0,0,0,0.5);
  position: absolute;      /* rasm ustiga chiqadi */
  top: 8px;                /* yuqori chekka */
  right: 8px;              /* o‚Äòng chekka */
  cursor: default;
  transition: transform 0.2s;
}
.verified-star:hover {
  transform: rotate(20deg) scale(1.2);
}
</style>

<style>
/* CSS Variables for Theming */
:root {
  --primary: #007bff;
  --warning: #ffc107;
  --shadow: 0 4px 12px rgba(0,0,0,0.1);
}

/* Minimal hover for performance and accessibility */
.hover-card {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.hover-card:hover, .hover-card:focus {
  transform: translateY(-5px);
  box-shadow: var(--shadow);
}

/* Image hover effect */
.hover-card img {
  transition: transform 0.3s ease;
}
.hover-card:hover img {
  transform: scale(1.05);
}

/* Text truncation */
.text-truncate {
  display: -webkit-box;
  -webkit-line-clamp: 1;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.text-truncate-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Badge styling */
.badge {
  font-size: 0.85rem;
  padding: 0.3em 0.6em;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  transition: transform 0.2s ease;
}
.hover-card:hover .badge {
  transform: scale(1.05);
}

/* High contrast for accessibility */
.badge.bg-primary { background-color: var(--primary) !important; color: #fff; }
.badge.bg-warning { background-color: var(--warning) !important; color: #212529; }

/* Button hover */
.btn-outline-primary {
  transition: background-color 0.2s ease, color 0.2s ease;
}
.btn-outline-primary:hover {
  background-color: var(--primary);
  color: #fff;
}
</style>

<!-- PAGINATION -->
{% if services.has_other_pages %}
<nav aria-label="Page navigation" class="mt-4">
    <ul class="pagination justify-content-center">
        {% if services.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?page={{ services.previous_page_number }}">Oldingi</a>
        </li>
        {% endif %}
        {% for num in services.paginator.page_range %}
        <li class="page-item {% if services.number == num %}active{% endif %}">
            <a class="page-link" href="?page={{ num }}">{{ num }}</a>
        </li>
        {% endfor %}
        {% if services.has_next %}
        <li class="page-item">
            <a class="page-link" href="?page={{ services.next_page_number }}">Keyingi</a>
        </li>
        {% endif %}
    </ul>
</nav>
{% endif %}
